%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CS630: Database Management Systems
% Copyright 2014 Pejman Ghorbanzade <pejman@ghorbanzade.com>
% Creative Commons Attribution-ShareAlike 4.0 International License
% More info: https://github.com/ghorbanzade/beacon
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Question 3}

Consider a database schema with three relations:\\

\begin{terminal}
Employee (@*\underline{eid}*@:integer, ename:string, age:integer, salary:real)
Works (@*\underline{eid}*@:integer, @*\underline{did}*@:integer, pct\_time:integer)
Department (@*\underline{did}*@:integer, dname:string, budget:real, managerid:integer)
\end{terminal}

The keys are underlined in each relation.
Relation \texttt{Employee} stores employee information such as unique identifier \texttt{eid}, employee name \texttt{ename}, \texttt{age} and \texttt{salary}.
Relation \texttt{Department} stores the department unique identifier \texttt{did}, department name \texttt{dname}, the department \texttt{budget} and \texttt{managerid} which is the \texttt{eid} of the employee who is managing the department.
The \texttt{managerid} value must always be found in the \texttt{eid} field of a record of the \texttt{Employee} relation.
The \texttt{Works} relation tracks which employee works in which department, and what percentage of the time \texttt{pct\_time} s/he allocates to that department.
Note that, an employee can work in several departments.

Provide SQL statements for the following:

\begin{enumerate}

\item
Create a view \texttt{ManagerSummary} that lists for every department the department name, manager ID and manager name, manager salary and the number of employees in that department.
The view will have five columns with headings: \texttt{DeptName}, \texttt{MgrID}, \texttt{MgrName}, \texttt{MgrSalary} and \texttt{EmpCount}.

\item
Query the view above to retrieve the set of distinct salaries of managers who manage a department called \textit{Sales}.

\item
Query the view above to find the name of the manager  who manages most employees.
If the same employee works in several departments, that employee is counted once in each  of the departments.
The manager is included in the count the same as all other employees, i.e., based on his or her records in the \texttt{Works} table.

\end{enumerate}

\subsection*{Solution}

\lstset{language=sql}
\lstinputlisting[firstline=8]{
	\topDirectory/src/sql/hw03/hw03q03.sql
}
